<html>
	<head>
		<title>TouchTerrain Bootstrap test</title>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>

		<meta name="viewport" content="width=device-width, initial-scale=1">
  		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
		
		<script src="https://cdn.theme.iastate.edu/fontawesome/5.0/js/all.min.js"></script>
		<link href="https://cdn.theme.iastate.edu/nimbus-sans/css/nimbus-sans.css" rel="stylesheet">
		<link href="https://cdn.theme.iastate.edu/merriweather/css/merriweather.css" rel="stylesheet">
		<link rel="stylesheet" href="static/css/iastate.css">

		<!--
	    <script src="static/js/vendor/bootstrap.min.js"></script>
	    <script src="static/js/vendor/bootstrap-submenu.min.js"></script>
		<script src="static/js/iastate.js"></script>
		<link rel="stylesheet" href="static/css/iastate.css">
		-->
		
		<script type="text/javascript" async defer
			src="https://maps.google.com/maps/api/js?key={{ google_maps_key }}">
			<!-- key=<nothing> will give you the crappy google map background, which is still usable.
			If you want a proper google maps version you need replace the above line with
			one that uses your API key, which you will need to get from Google:  https://developers.google.com/maps/documentation/javascript/get-api-key#get-an-api-key
			As his app uses a simple embedded map it should still be free for < 25,000 requests (?)
			Put this key into a text file called GoogleMapsKey.txt in the server folder
			Note: if the key is wrong, you'll get a Google key error and you won't see any map. -->
		</script>
		  
		{% if GOOGLE_ANALYTICS_TRACKING_ID %}
			<script>
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

			ga('create',
				'{{GOOGLE_ANALYTICS_TRACKING_ID}}',  // put your own tracking id in server/config.py
				'auto');
			ga('send', 'pageview');
			</script>
		{% endif %}
		
		<script> {% include 'touchterrain.js' %} </script> <!-- will get inlined via jinja! -->

		
	</head>
	<body>
		<div class="container-fluid">
			<div class="page-header">
			  <h3>
				<!-- TouchTerrain is currently NOT working, sorry!  &nbsp -->
				TouchTerrain: Easily Create 3D-Printable Terrain Models (BUILDID)  &nbsp
				<small> 
					<a href="https://touchterrain.blogspot.com/" target="_blank">
					What new in ver. 2.5?</a> &nbsp <a href="https://docs.google.com/document/d/1GlggZ47xER9N85Qls_MiE1jNuihlYEZnFFSVZtX8bKU/pub" target="_blank">
					Help</a>
				</small>
			  </h3>
			</div>
			<div class="row">
				<div class="col-md-8"><div style="height:75%" id="map">Map didn't load</div></div>
				<div class="col-md-4" id="controlbox">

					<form action="/" method="post" id="reloadform" class="form-horizontal">
						<div class="form-group">
						  <label for="DEM_name">Elevation Data source:</label>
						  <a href="https://developers.google.com/earth-engine/datasets/" id="DEM_link" target="_blank">(Info on DEM)</a>
						  <select class="form-control" id="DEM_name" name="DEM_name" onchange="submit_for_reload('GET')" title="Switch to different Digital Elevation data source" >
							<option value="USGS/NED" selected>USGS/NED </a>(10 m resolution, US only)</option>
							<!--<option value="NRCan/CDEM">NRCan/CDEM (20 m resolution, Canada only)</option>-->
							<option value="JAXA/ALOS/AW3D30/V2_2" >AW3D30 (30m resolution, worldwide, good quality)</option>
							<option value="USGS/SRTMGL1_003">SRTM GL1 (30m resolution, worldwide-ish, less good)</option>
							<option value="USGS/GMTED2010">GMTED2010 (230m resolution, worldwide)</option>
							<option value="USGS/GTOPO30">GTOPO30 (1000m resolution, worldwide, no bathymetry)</option>
							<option value="CPOM/CryoSat2/ANTARCTICA_DEM">ANTARCTICA_DEM (1000m resolution, Antarctica only)</option>
							<option value="NOAA/NGDC/ETOPO1">ETOPO1 (2000m resolution, worldwide, with bathymetry)</option>
						  </select>
						</div> 

						<!-- hidden ids so they get put into the URL on reload -->
						<input type="hidden" name="maptype" id="maptype" value="NULL">
						<input type="hidden" name="gamma" id="gamma" value="NULL">
						<input type="hidden" name="transp" id="transp" value="NULL">
						<input type="hidden" name="hsazi" id="hsazi" value="NULL">
						<input type="hidden" name="hselev" id="hselev" value="NULL">
						<input type="hidden" name="map_lat" id="map_lat" value="NULL">
						<input type="hidden" name="map_lon" id="map_lon" value="NULL">
						<input type="hidden" name="map_zoom" id="map_zoom" value="NULL">
						<input type="hidden" id="trlat" name="trlat" value="NULL" >
						<input type="hidden" id="trlon" name="trlon" value="NULL" >
						<input type="hidden" id="bllat" name="bllat" value="NULL" >
						<input type="hidden" id="bllon" name="bllon" value="NULL" >
						<input type="hidden" id="tilewidth" name="tilewidth" value="NULL" >
						<input type="hidden" id="ntilesx" name="ntilesx" value="NULL" >
						<input type="hidden" id="ntilesy" name="ntilesy" value="NULL" >
						<input type="hidden" id="printres" name="printres" value="NULL" >
						<input type="hidden" id="basethick" name="basethick" value="NULL" >
						<input type="hidden" id="zscale" name="zscale" value="NULL" >
						<input type="hidden" id="fileformat" name="fileformat" value="NULL" >
						<input type="hidden" id="manual" name="manual" value="NULL" >
						<input type="hidden" id="polyURL" name="polyURL" value="NULL" >
					</form>


					<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
					  <div class="panel panel-default">
					    <div class="panel-heading" role="tab" id="headingOne">
					      <h4 class="panel-title">
					        <a role="button" data-toggle="collapse" data-parent="#accordion" href="#hillshade_panel" aria-expanded="true" aria-controls="hillshade_panel">
					          Terrain relief (hillshade) settings:
					        </a>
					      </h4>
					    </div>
					    <div id="hillshade_panel" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingZero">
						  <div class="panel-body">
							Transparency(%):
							<input type="range" id="hillshade_transparency_slider" min="0" max="100" value=""
								title="Changes the hillshade transparentcy from 0% (left, no google map, only hillshading) to 100% (right, no hillshading, only google map)"
								list="tickmarks"
								step="1" oninput="updateTransparency(this.value);">
								<datalist id="tickmarks">
								<option value="0"></option>
								<option value="10"></option>
								<option value="20"></option>
								<option value="30"></option>
								<option value="40"></option>
								<option value="50"></option>
								<option value="60"></option>
								<option value="70"></option>
								<option value="80"></option>
								<option value="90"></option>
								<option value="100"></option>
								</datalist>
							Gamma:
							<!-- <input type="range" id="hs_slider" min="0.1" max="2.0" value="0" step="0.05"
									oninput="updateGamma(this.value)" onmouseup="submit_for_reload('GET')"> -->
							<input type="text" id="gamma2"  maxlength="4" size="2" value="1.0" 
								title="To change the hillshade gamma value, enter the value and hit Enter. Will reload the map." 
									onkeydown="if (event.keyCode == 13) { updateGamma(this.value); submit_for_reload('GET');}"> 
							<br>
							Sun direction:
							<select title="Defines the direction (compass heading) from which the Sun shines to create the hillshade relief. Note that South will typically result in a flipped relief perception!"
								id="hsazi2" name="Sun Direction" onchange="submit_for_reload('GET');">
								<option value="270">West</option>
								<option value="315" selected>North-West</option>
								<option value="360">North</option>
								<option value="45">North-East</option>
								<option value="90">East</option>
								<option value="180">South</option>
							</select><br>
							
							Sun angle: 
							<select title="Defines the vertical Sun angle, i.e. how high the Sun is above the horizon. Use it to enhance detail for different types of terrain. Will also adjust gamma"
								id="hselev2" name="Sun Elevation" onchange="updateHillshadeElevation(this.value); submit_for_reload('GET');">
								<option value="55">steep</option> 
								<option value="45" selected >normal</option>
								<option value="35">bit flat </option>
								<option value="25">flat </option>
								<option value="10">very flat </option>
								<option value="5">extremely flat</option>
							</select>
						  </div>
					    </div>
					  </div>

					  <label>Area Selection Box:</label> 
						<input id="recenter-box-button" type="button"  class="btn btn-small"
							title="re-centers the red Area Selection box insides the currently viewed map"
							onclick="center_rectangle()"
							value="Re-center box on map">
						<br>
					  	<!-- Put the box corner coords here so they get transmitted with get -->
						<input type="text" id="trlat2" name="trlat" maxlength="7" size="7" value="NULL" title="(trlat)" readonly> N
						<input type="text" id="trlon2" name="trlon" maxlength="8" size="8" value="NULL" title="(trlon)" readonly> E (Top right corner)<br>

						<input type="text" id="bllat2" name="bllat" maxlength="7" size="7" value="NULL" title="(bllat)" readonly> N
						<input type="text" id="bllon2" name="bllon" maxlength="8" size="8" value="NULL" title="(bllon)" readonly> E (Lower left corner) <br>


					  <div class="panel panel-default">
					    <div class="panel-heading" role="tab" id="headingOne">
					      <h4 class="panel-title">
					        <a role="button" data-toggle="collapse" data-parent="#accordion" href="#printOptionPanel" aria-expanded="true" aria-controls="printOptionPanel">
					          3D Printer Options:
					        </a>
					      </h4>
					    </div>
					    <div id="printOptionPanel" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
					      <div class="panel-body">
							<form action="/export" method="post" enctype=multipart/form-data>
								Use polygon from KML file <input type="file" id="kml_file" name="kml_file"/>
							</br> 
							<input type="hidden" name="DEM_name" id="DEM_name2" value="NULL">
							<input type="hidden" id="options_polyURL" name="polyURL" size="0"
								title="URL to a KML file with a polygon. Must be a publically read-able cloud file. Used as outline for the 3D print. Supersedes the Area Selection box"
							> 

					      </div>
					    </div>
					  </div>

						<div class="panel panel-default">
					    <div class="panel-heading" role="tab" id="headingFive">
					      <h4 class="panel-title">
					        <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseFive" aria-expanded="false" aria-controls="collapseFive">
					          Water and Base Settings
					        </a>
					      </h4>
					    </div>
							<div id="collapseFive" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingFive">
					      <div class="panel-body">
									<div class="form-group">
										<label class="control-label col-sm-6">Water Drop (mm):</label>
										<div class="col-sm-4">
											<input name="waterDrop" type="range" min="0" max="5" step="1" value="0"  onchange="changeWaterDrop()">
										</div>
										<div class="col-sm-2" id="waterDropLabel">0</div>
									</div>
									<div class="form-group">
										<label class="control-label col-sm-6">Base Height (mm):</label>
										<div class="col-sm-4">
											<input name="baseHeight" type="range" min="1" max="10" step="1" value="1"  onchange="changeBaseHeight()">
										</div>
										<div class="col-sm-2" id="baseHeightLabel">2</div>
									</div>
					      </div>
					    </div>
					  </div>

						<div class="panel panel-default">
					    <div class="panel-heading" role="tab" id="headingThree">
					      <h4 class="panel-title">
					        <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
					          Instructions
					        </a>
					      </h4>
					    </div>
							<div id="collapseFour" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
					      <div class="panel-body">

									<div id="inst">
										<h2 align='center' style="margin-top:-10">Instructions</h2></br>
										<ul style="margin-top:-20">
											<li>Select the area you want an STL of using the red box</li>
											<li>'Center to View' will move the box. It's also draggable</li>
											<li>Rotate and resize the box as needed</li>
											<li>Z-Scale exaggerates the vertical scale of models</li>
											<li>Water drop lowers the height of the oceans for emphasis</li>
											<li>Don't worry about the box skewing with rotations - the model will be accurate to the real terrain</li>
										</ul>
									</div>

					      </div>
					    </div>
					  </div>
					</div>

					<button type="submit" id="genButton" class="btn btn-default">Generate Model</button>
					<a id="downloadbtn" style="visibility:hidden" role="button" class="btn btn-default" href="stls/rawmodel-0.stl">Download</a>
				</form>
				<center><small>Terrain2STL is a free-to-use service, but if you want to help <a href="/support.html">support</a> the site, donations are welcome.</small></center>
				</div>
			</div>
			<div class="row">
	      </br>
	      <center>
	        <small><i>
	          Terrain2STL creates STL files using the <a href='http://www.cgiar-csi.org/data/srtm-90m-digital-elevation-database-v4-1'>SRTM3 dataset</a> from 2000,
	          which has a resolution of about 90 meters on the equator.
	        </i></small>
	      </center>
	    </div>
	    <div class="row">
	      </br>
	      <center>
	        <small>
	          <a href="/">Home</a> | Terrain2STL | <a href="mailto:j.thatcher.c+t2s@gmail.com">Contact</a></br>
	        </small>
	      </center>
	    </div>

		</div>

	</body>
</html>